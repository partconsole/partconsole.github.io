<script>
  window.addEventListener('DOMContentLoaded', () => {
    const fileList = Array.from(document.querySelectorAll('#older-files li'));
    const container = document.getElementById('older-container');

    // Parse files into an array with dates
    const filesWithDates = fileList.map(file => {
      const fileName = file.textContent.trim();
      const dateMatch = fileName.match(/exchange_rate_(\d{4}-\d{2}-\d{2})\.xlsx/);
      if (dateMatch) {
        const dateStr = dateMatch[1];
        const dateObj = new Date(dateStr);
        return { fileName, dateObj };
      }
      return null;
    }).filter(item => item !== null);

    // Sort by date descending (newest first)
    filesWithDates.sort((a, b) => b.dateObj - a.dateObj);

    // Now generate the cards
    filesWithDates.forEach(item => {
      const { fileName, dateObj } = item;
      const day = String(dateObj.getDate()).padStart(2, '0');
      const month = String(dateObj.getMonth() + 1).padStart(2, '0');
      const year = dateObj.getFullYear();
      const formattedDate = `${day}/${month}/${year}`;
      const weekNumber = getISOWeekNumber(dateObj);
      const weekInfo = `Week${weekNumber}/${year}`;

      const card = document.createElement('div');
      card.className = 'report-card';

      card.innerHTML = `
        <div class="report-info">${formattedDate} - ${weekInfo}</div>
        <a href="older/${fileName}" download>
          <button class="export-btn">Download</button>
        </a>
      `;

      container.appendChild(card);
    });
  });

  function getISOWeekNumber(date) {
    const target = new Date(date.valueOf());
    const dayNr = (date.getDay() + 6) % 7;
    target.setDate(target.getDate() - dayNr + 3);
    const firstThursday = new Date(target.getFullYear(), 0, 4);
    const weekNumber = 1 + Math.round(((target.getTime() - firstThursday.getTime()) / 86400000 - 3 + ((firstThursday.getDay() + 6) % 7)) / 7);
    return weekNumber;
  }
</script>
